files:
  "/etc/systemd/system/gunicorn.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Gunicorn instance to serve Django
      After=network.target

      [Service]
      User=webapp
      Group=webapp
      WorkingDirectory=/var/app/current
      Environment="PATH=/var/app/venv/staging/bin"
      ExecStart=/var/app/venv/staging/bin/gunicorn --workers 3 --bind 0.0.0.0:8000 config.wsgi:application

      [Install]
      WantedBy=multi-user.target

commands:
  enable_gunicorn:
    command: "systemctl enable gunicorn"
  restart_gunicorn:
    command: "systemctl restart gunicorn"
